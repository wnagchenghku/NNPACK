
# make -j
ISPC=ispc
ISPCFLAGS=-O2 --arch=x86 --target=sse4-i32x4

CC = gcc
CFLAGS = -m32 -Wl,-hash-style=sysv -fno-stack-protector -fPIC -nostdlib -shared

default: so

.PHONY: clean

clean:
        /bin/rm -rf objs *.so

obj := $(patsubst %.c, %.so, $(wildcard *.c))
so: $(obj)

%.so: %.c.o %.ispc_o
        $(CC) $(CFLAGS) $^ -o $@

%.ispc_o: %.ispc
        $(ISPC) $(ISPCFLAGS) $< -o $@

%.c.o: %.c
        $(CC) -m32 -c $< -o $@
